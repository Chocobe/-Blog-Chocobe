---
layout: post
current: post
cover: assets/images/tagImage/bg_vue.png
hideCover: True
navigation: True
title: "#03 유효성 검사 3rd 라이브러리: vee-validate"
date: 2021-05-30 11:00:00
tags: [vue]
class: post-template
subclass: 'post'
author: chocobe
---

``Vue`` 프레임워크용 유효성 검사 라이브러리인 ``vee-validate``에 대해 알아보겠습니다.

``vee-validate``는 ``Vue Component`` 형식으로 제공하는 ``Vue 전용`` 라이브러리 입니다.

> <a href="https://vee-validate.logaretm.com/v3/" target="_blank">공식 홈페이지: https://vee-validate.logaretm.com/v3/</a>

<img src="assets/images/vue/03_vue/03_vue_01.png" class="shadow" alt="vee-validate"><br/>

<br/>

## 설치

``npm``을 사용하여 설치할 수 있으며, 필수 전역 설정은 없습니다.

```bash
$ npm i vee-validate
``` 

<br/>

## 사용법

사용방법은 ``vee-validate`` 라이브러리에서 ``import``하여 사용하는 방식 입니다.

```vue
<template>
  <v-container>
    <v-card>
      <ValidationProvider name="Email" rules="myEmailRule:20" v-slot="{ error }">
        <v-text-field label="Email" v-model="email" :error-messages="error.errors[0]"></v-text-field>
      </ValidationProvider>     
    </v-card>  
  </v-container>
</template>

<script>
import { ValidationProvider, extend } from "vee-validate";

// 규칙 정의
extend("myEmailRule", (value, params) => {
  const limit = params[0];

  if(value && value.length > limit) {
    return `Email은 ${limit} 을(를) 넘을 수 없습니다.`
  }

  return true;
});

export default {
  components: {
    ValidationProvider,
  },

  data: () => {
    return {
      email: null,
    };
  },
};
</script>
```

<br/>

위의 코드를 살펴 보겠습니다.

먼저 ``ValidationProvider`` 와 ``extend``를 ``import`` 하였습니다.

``ValidationProvider``는 유효성 검사 컴포넌트이며, ``extend`` 함수는 ``ValidationProvider``에서 사용할 ``규칙을 정의`` 합니다.

<br/>

``extend``의 ``첫번째 인자``가 규칙명이 되며, ``ValidationProvider``의 ``rules``에 문자열로 설정합니다.

<br/>

``<ValidationProvider rules="규칙">``의 ``rules``를 설정할 때, 다음과 같은 규칙을 사용할 수 있습니다.

> ``rules="규칙명1:인자1,인자2,인자3|규칙명2:인자a,인자b"``

위의 ``rules``는 다음과 같은 의미를 가집니다.

* "규칙명1" 이라는 규칙 사용
* 전달 ``params``는 ``인자1``, ``인자2``, ``인자3`` 3가지
* "규칙명2" 라는 규칙 사용 (복수 규칙)
* 전달 ``params``는 ``인자a``, ``인자b`` 2가지

<br/>

따라서, 위의 예시에서 사용한 유효성 규칙은 다음과 같습니다.

* 사용할 규칙명: "myEmailRule"
* 전달인자: 20

<br/>

이제 ``myEmailRule``을 정의한 ``extend``를 살펴 보겠습니다.

``extend``는 규칙 정의 함수이며 다음과 같은 형식을 가집니다.

* 첫번째 인자: 새로 정의할 ``규칙명``
* 두번째 인자: 유효성 검사 ``Callback 함수``
    * ``Callback의 params``: (입력값, 인자 배열)
    
예시에서는 ``<ValidationProvider rules="myEmailRule:20">`` 으로 사용하므로, ``Callback 함수``의 ``인자 배열``은 ``20``이 넘어옵니다.

<br/>

위의 코드를 실행해 보면, 입력한 문자열이 ``20``글자를 넘으면, ``error`` 메시지가 출력되며, ``error`` 데이터는 ``slot props``로 넘어옵니다.

``slot props``로 넘어오는 데이터는 ``Object``이며, ``{ errors }``의 ``[0]``번 인덱스가 ``에러 메시지``로 넘어 옵니다.


<br/><hr/><br/>

## ``vee-validate`` 라이브러리에서 제공하는 ``규칙`` 사용하기

``vee-validate`` 라이브러리는 자주 사용하는 규칙을 제공하고 있습니다.

```vue
<script>
import { extend } from "vee-validate";
import { email } from "vee-validate/dist/rules";

extend("email", email);
</script>
```

<br/>

``vee-validate/dist/rules`` 경로에서 다양한 규칙을 가져와 사용할 수 있습니다.

<img src="assets/images/vue/03_vue/03_vue_02.png" class="shadow" alt="vee-validate"><br/>

<br/>

``email`` 규칙에서 ``에러 메시지``만 커스텀 한다면, 다음과 같이 할 수 있습니다.

```vue
<script>
import { extend } from "vee-validate";
import { email } from "vee-validate/dist/rules";

extend("myRuleEmail", {
  ...email,
  params: ["인자명"],
  message: (fieldName, placeholders) => {
    return `${fieldName}은 ${placeholders.인자명}을 넘을 수 없습니다.`;
  },
});
</script>
```

<br/>

아래는 ``extend``에 대한 ``interface`` 입니다.

```typescript
// extend 정의
export function extend(name: string, schema: ValidationRule) {
  // makes sure new rules are properly formatted.
  guardExtend(name, schema);

  // Full schema object.
  if (typeof schema === 'object') {
    RuleContainer.extend(name, schema);
    return;
  }

  RuleContainer.extend(name, {
    validate: schema
  });
}

// ValidationRule 정의
export type ValidationRule = ValidationRuleFunction | ValidationRuleSchema;

// ValidationRuleFunction 정의
export type ValidationRuleFunction = (
  value: any,
  params: any[] | Record<string, any>
) => boolean | string | ValidationRuleResult | Promise<boolean | string | ValidationRuleResult>;

// ValidationRuleSchema 정의
export interface ValidationRuleSchema {
  validate?: ValidationRuleFunction;
  params?: RuleParamSchema[];
  message?: ValidationMessageTemplate;
  lazy?: boolean;
  computesRequired?: boolean;
  castValue?(value: any): any;
}

// ValidationMessageTemplate 정의
export type ValidationMessageTemplate = string | ValidationMessageGenerator;

// ValidationMessageGenerator 정의
export interface ValidationMessageGenerator {
  (field: string, params: Record<string, any>): string;
}

// RuleParamSchema 정의
export type RuleParamSchema = string | RuleParamConfig;

// RuleParamConfig 정의
export interface RuleParamConfig {
  name: string;
  isTarget?: boolean;
  default?: any;
  cast?(value: any): any;
}
```

> <a href="https://github.com/logaretm/vee-validate/blob/v3/src/extend.ts" target="_blank">extend 코드 Github: https://github.com/logaretm/vee-validate/blob/v3/src/extend.ts</a>

> <a href="https://github.com/logaretm/vee-validate/blob/v3/src/types.ts" target="_blank">하위 코드 Github: https://github.com/logaretm/vee-validate/blob/v3/src/types.ts</a>

## ``<ValidationObserver>`` 를 사용한 전체 유효성 상태값 사용하기

서버로 전송할 데이터는 모든 유효성 검사를 통과한 후, 전달 되어야 합니다.

이때 사용할 수 있는 컴포넌트가 ``<ValidationObserver>`` 입니다.

``<ValidationObserver>`` 컴포넌트는 복수의 ``<ValidationProvider>``를 가질 수 있는데, 모든 ``<ValidationProvider>``가 유효한지 아닌지에 대한 상태값을 알려줍니다.

<br/>

다음은 ``<ValidationObserver>``를 사용한 예 입니다.

```vue
<template>
  <v-container>
    <v-form @submit.prevent="mySubmit">
      <!-- ValidationObserver 바디에 있는 모든 ValidationProvider의 유효성 상태값 감시 -->
      <ValidationObserver v-slot="{ invalid }">
        <ValidationProvider 
          v-slot="{ errors }" 
          :rules="{ required: true, max: 10 }" 
          name="유저명"
        >
          <v-text-field 
            v-model="userName" 
            label="유저명" 
            :error-messages="errors"
          ></v-text-field> 
        </ValidationProvider>

        <ValidationProvider 
          v-slot="{ errors }" 
          :rules="{ required: true, email: true }"
          name="유저 이메일" 
        >
          <v-text-field 
            v-model="userEmail" 
            label="유저 이메일" 
            :error-messages="errors"
          ></v-text-field>
        </ValidationProvider>

        <v-btn type="submit" :disabled="invalid">전송</v-btn>
        
        <v-btn @click="myReset">초기화</v-btn>
      </ValidationObserver>
    </v-form>  
  </v-container>
</template>

<script>
import { 
  ValidationObserver,
  ValidationProvider,
  extend,
} from "vee-validate";

import {
  email,
  required,
} from "vee-validate/dist/rules";

extend("required", {
  ...required,
  message: (fieldName) => {
    return `${fieldName}은(는) 필수값 입니다.`;
  },
});

extend("email", {
  ...email,
  message: () => {
    return `Email 형식이 아닙니다.`;
  },
});

export default {
  data: () => {
    return {
      userName: null,
      userEmail: null,
    };
  },

  methods: {
    async mySubmit() {
      const observer = this.$refs.observer;
      const isValid = await observer.validate();

      if(isValid) {
        alert("입력값 모두 유효! 데이터 제출");
      } else {
        alert("유효성 검사 실패!");
      }
    },

    myReset() {
      this.userName = null;
      this.userEmail = null;

      this.$nextTick(() => {
        this.$refs.observer.reset();
      });
    },
  },
};
</script>
```

<br/>

위의 코드에서 ``<ValidationObserver ref="observer">``의 ``ref``는 ``script``에서 ``<ValidationObserver>``객체에 접근하기 위한 참조명 입니다.

``<ValidationObserver>``를 참조하면, ``전체 유효성 상태값``, ``전체 유효성 상태값 초기화`` 등의 기능을 사용할 수 있습니다.

* ``await this.$refs.observer.validate()``: 모든 ``ValidationProvider``가 유효할 경우, ``true``를 반환하는 함수 입니다.
* ``this.$refs.observer.reset()``: 모든 ``ValidationProvider``의 유효성 상태값을 초기화 합니다.

<br/>

``<ValidationObserver v-slot="{ invalid }">``의 ``Slot Props``는 모든 ``<ValidationProvider>``의 유효성 상태값을 알려줍니다.

``invalid``값을 사용하면, ``버튼`` 컴포넌트의 ``disabled`` 기능에 트리거를 사용할 수 있으므로, UX에 유용합니다.

<br/>

> <a href="https://vee-validate.logaretm.com/v3/guide/forms.html#handling-forms" target="_blank">https://vee-validate.logaretm.com/v3/guide/forms.html#handling-forms</a>


<hr/>

{% include content-list-vue.html %}

<hr/>
